---
parameters:
  env(ACLI_REPO_ROOT): "%kernel.project_dir%"
  app.repo_root: "%env(ACLI_REPO_ROOT)%"


services:
  _defaults:
    autoconfigure: true
    autowire: true
    bind:
      # This should be root directory of the repository where acli is being invoked (not the root of acli itself).
      $repoRoot: "%app.repo_root%"
    public: true

  # Register nearly all Acquia CLI classes as services.
  Acquia\Cli\:
    exclude: [../src/Kernel.php, ../src/Command/Api/ApiCommandBase.php]
    public: false
    resource: ../src

  # All commands inherit from a common base and use the same DI parameters.
  Acquia\Cli\Command\:
    resource: ../src/Command
    parent: Acquia\Cli\Command\CommandBase
    exclude: [../src/Command/CommandBase.php, ../src/Command/Api/ApiCommandBase.php]
  Acquia\Cli\Command\CommandBase:
    abstract: true

  # AcquiaCloudApi services.
  AcquiaCloudApi\Connector\Client: ~
  AcquiaCloudApi\Connector\ConnectorInterface: ~
  AcquiaLogstream\LogstreamManager: ~

  # Psr services.
  Psr\Log\LoggerInterface:
    alias: Symfony\Component\Console\Logger\ConsoleLogger

  # Symfony services.
  Symfony\Component\Console\Application: ~
  Symfony\Component\Console\Input\ArgvInput: ~
  Symfony\Component\Console\Input\InputInterface:
    alias: Symfony\Component\Console\Input\ArgvInput
  Symfony\Component\Console\Logger\ConsoleLogger: ~
  Symfony\Component\Console\Output\ConsoleOutput: ~
  Symfony\Component\Console\Output\OutputInterface:
    alias: Symfony\Component\Console\Output\ConsoleOutput

  # Amplitude service.
  Zumba\Amplitude\Amplitude: ~
